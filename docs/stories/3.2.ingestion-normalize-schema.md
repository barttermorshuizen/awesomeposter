# Story 3.2: Normalize Ingested Content

## Status
Draft

## Story
**As the** discovery pipeline,
**I want** to normalize fetched items into a consistent schema,
**so that** downstream scoring and dashboards can rely on clean data.

## Acceptance Criteria
1. Normalized record includes `id`, `clientId`, `sourceId`, `title`, `url`, `publishedAt`, `fetchedAt`, `extractedBody`, `rawHash`.
2. Source metadata captures content type (`article`, `rss`, `youtube`) and stores structured fields such as `channelId` or `feedUrl` when applicable.
3. When publication date is missing, default to fetch timestamp and mark `publishedAtSource="fallback"`.
4. HTML/markup boilerplate (nav, ads) stripped; body or description truncated to 5,000 characters max while retaining sentences.
5. YouTube video entries map description and (when available) transcript into `extractedBody`; RSS entries map feed summary/body using consistent sanitization.
6. All records stored in datastore and available to scoring service within 5 minutes of fetch completion.

## Tasks / Subtasks
- [ ] Implement extraction pipeline (readability or custom) with sanitization rules and adapters for RSS feeds and YouTube responses (AC 4, AC 5).
- [ ] Persist normalized entities via Drizzle models, including source metadata (AC 1, AC 2).
- [ ] Expose normalized queue/topic for scoring consumption (AC 6).
- [ ] Add hashing utility to detect content changes between runs (AC 1).
- [ ] Create unit tests for HTML extraction, RSS entries, and YouTube payloads (AC 4, AC 5).

## Dev Notes
- Keep extraction deterministic; avoid locale-specific features since English-only.
- Align with repo ASCII guidelines; sanitize smart quotes if needed.

### Testing
- Unit: parse sample articles with/without metadata.
- Integration: pipeline test from fetch stub â†’ normalized record persisted.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-03-29 | 0.1 | Draft for Epic: Ingestion & Normalization. | PM |

## Dev Agent Record
_Not yet worked._
