# Story 11.4: Company Information Facet Integration

## Status
Ready for Review

## Story
**As a** flex catalog maintainer,  
**I want** to add the `company_information` facet definition to the shared facet catalog and wire flex server capabilities to consume it,  
**so that** marketing agents can rely on a canonical company profile for consistent planning and execution.

**Dependencies:** Story 11.1 (marketing capability taxonomy), Story 11.2 (catalog rip & replace), and Story 11.3 (sandbox validation readiness) completed. (`docs/stories/11.1.flex-marketing-capability-taxonomy.md`, `docs/stories/11.2.flex-marketing-capability-catalog.md`, `docs/stories/11.3.flex-marketing-sandbox-validation.md`)

## References
- `docs/prd/epic-flex-marketing-agency-capabilities.md`
- `docs/architecture/flex-agents-server/512-reference-facet-catalog.md#facet-company_information`
- `docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#facet-catalog`
- `docs/architecture/flex-agents-server/5-core-concepts.md#facet-definition`
- `docs/architecture/flex-agents-server/5-core-concepts.md#facet-aligned-capabilities`
- `docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#marketing-catalog-rollout--rollback`
- `docs/architecture/flex-agents-server/13-verification.md`
- `docs/architecture/tech-stack.md#1-core-runtime-components`
- `docs/architecture/coding-standards.md#4-agents-server-standards`
- `docs/architecture/source-tree.md#4-agents-server`

## Acceptance Criteria
1. The shared `FacetCatalog` exposes the `company_information` facet with schema, metadata (direction `input`, required-by-default), and marketing tags exactly as defined in the architecture facet catalog so planner helpers and registry validation recognize it. (`docs/architecture/flex-agents-server/512-reference-facet-catalog.md#facet-company_information`, `docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#facet-catalog`)
2. Marketing capability registrations update their `inputContract` coverage to include `company_information` wherever strategist, copywriter, designer, or reviewer agents require brand guardrails, keeping facet-aligned contracts authoritative and self-registration payloads valid. (`docs/architecture/flex-agents-server/512-reference-facet-catalog.md#facet-company_information`, `docs/architecture/flex-agents-server/5-core-concepts.md#facet-aligned-capabilities`)
3. Registry and planner validation tests extend coverage for the new facet (schema compilation, inventory listings, and sandbox metadata) so automated checks fail if the facet definition or contract wiring regresses. (`docs/architecture/flex-agents-server/13-verification.md`)
4. Marketing catalog rollout guidance notes the addition of the `company_information` facet and confirms sandbox metadata continues to advertise the curated marketing set with the new facet available for downstream consumers. (`docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#marketing-catalog-rollout--rollback`)

## Tasks / Subtasks
- [x] Implement the `company_information` facet entry in `packages/shared/src/flex/facets/catalog.ts`, matching schema fields, examples, metadata, and tags from the architecture reference. (AC 1) (`docs/architecture/flex-agents-server/512-reference-facet-catalog.md#facet-company_information`, `docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#facet-catalog`)
- [x] Update marketing capability modules and registration payloads so contracts referencing brand context include `company_information` alongside existing facets. (AC 2) (`docs/architecture/flex-agents-server/5-core-concepts.md#facet-aligned-capabilities`)
- [x] Refresh shared facet compiler and sandbox metadata tests to assert the new facet compiles, serializes, and lists correctly. (AC 3) (`docs/architecture/flex-agents-server/13-verification.md`)
- [x] Amend marketing catalog rollout documentation/checklists to note the new facet dependency and any sandbox verification expectations. (AC 4) (`docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#marketing-catalog-rollout--rollback`)

## Story Context
- Epic objective is to equip marketing workflows with curated facets/capabilities while avoiding transport changes, and the `company_information` facet extends that toolkit. (`docs/prd/epic-flex-marketing-agency-capabilities.md`)
- `FacetCatalog` additions propagate automatically across planner, registry, and sandbox consumers, so expanding it remains the single source of truth for new schemas. (`docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#facet-catalog`)
- Planner assembly and capability validation depend on accurate facet contracts to merge schemas and enforce guardrails during execution. (`docs/architecture/flex-agents-server/5-core-concepts.md#facet-aligned-capabilities`)

## Dev Notes
- **Previous Story Insights:** No specific guidance found in architecture docs.
- **Data Models:** `company_information` is a bidirectional facet capturing company identity, tone guidance, audience segments, preferred channels, and resolvable brand asset URLs required for downstream agents. [Source: architecture/flex-agents-server/512-reference-facet-catalog.md#facet-company_information]
- **API Specifications:** Facet catalog updates surface through capability registration and sandbox metadata endpoints powered by the shared catalog utilities. [Source: architecture/flex-agents-server/11-capability-registry-agent-contracts.md#facet-catalog]
- **Component Specifications:** No specific guidance found in architecture docs.
- **File Locations:** Shared facet definitions live in `packages/shared/src/flex/`, while agents server registrations and sandbox routes reside under `packages/flex-agents-server/`. [Source: architecture/source-tree.md#4-agents-server]
- **Testing Requirements:** Registry and planner suites under `packages/shared/__tests__/flex/` and `packages/flex-agents-server/__tests__/` validate facet compilation and sandbox metadata integrity. [Source: architecture/flex-agents-server/13-verification.md]
- **Technical Constraints:** Implement updates in TypeScript following agents server coding standards and shared stack expectations. [Source: architecture/tech-stack.md#1-core-runtime-components] [Source: architecture/coding-standards.md#4-agents-server-standards]

## Project Structure Notes
- Facet catalog entries belong in `packages/shared/src/flex/facets/catalog.ts`, with associated capability registrations and tests under `packages/flex-agents-server/` per workspace layout. [Source: architecture/source-tree.md#4-agents-server]

## Testing
- Execute `npm run test:unit -- packages/shared/__tests__/flex/facet-contract-compiler.spec.ts packages/flex-agents-server/__tests__/facets/facet-contracts.spec.ts packages/flex-agents-server/__tests__/docs/facet-inventory.spec.ts packages/flex-agents-server/__tests__/sandbox/metadata.spec.ts` to confirm facet compilation and sandbox outputs include `company_information`. [Source: architecture/flex-agents-server/13-verification.md]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-19 | 0.1 | Draft outlining company information facet integration plan for marketing catalog. | Scrum Master |
| 2025-10-30 | 1.0 | Implemented company_information facet across shared catalog, marketing capabilities, tests, and documentation updates. | James (Dev Agent) |

## Dev Agent Record

### Agent Model Used
- James (Full Stack Developer) – GPT-5 Codex

### Debug Log References
- `npm run test:unit -- packages/shared/__tests__/flex/facet-contract-compiler.spec.ts packages/flex-agents-server/__tests__/facets/facet-contracts.spec.ts packages/flex-agents-server/__tests__/docs/facet-inventory.spec.ts packages/flex-agents-server/__tests__/flex-sandbox-metadata.spec.ts`

### Completion Notes List
- Added the `company_information` facet to `packages/shared/src/flex/facets/catalog.ts` with the architecture-defined schema, examples, metadata, and marketing tags.
- Required `company_information` in marketing capability registrations and agent modules so strategist, copywriter, designer, and director workflows load brand guardrails, updating prompts where needed.
- Extended marketing catalog helpers, integration smoke tests, sandbox metadata coverage, and registry specs to validate the new facet and keep planner/run fixtures aligned.
- Documented rollout guidance and inventory tables to reference the facet while ensuring sandbox metadata continues to surface the curated marketing set.

### File List
- packages/shared/src/flex/facets/catalog.ts
- packages/shared/src/flex/marketing-catalog.ts
- packages/flex-agents-server/src/agents/marketing/strategist-social-posting.ts
- packages/flex-agents-server/src/agents/marketing/strategist-positioning.ts
- packages/flex-agents-server/src/agents/marketing/copywriter-socialpost-drafting.ts
- packages/flex-agents-server/src/agents/marketing/copywriter-messaging.ts
- packages/flex-agents-server/src/agents/marketing/designer-visual-design.ts
- packages/flex-agents-server/src/agents/marketing/director-social-review.ts
- packages/flex-agents-server/src/agents/marketing/director-positioning-review.ts
- packages/flex-agents-server/__tests__/marketing-flex-run.integration.spec.ts
- packages/flex-agents-server/__tests__/marketing-strategy-smoke.spec.ts
- packages/flex-agents-server/__tests__/capability-registry-facets.spec.ts
- packages/flex-agents-server/__tests__/flex-sandbox-metadata.spec.ts
- docs/architecture/flex-agents-server/512-reference-facet-catalog.md
- docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md
- docs/architecture/flex-agents-server.md
- docs/stories/11.4.flex-marketing-company-information-facet.md

## QA Results
- CONCERNS – `company_information` facet metadata sets `direction` to `input`, while the architecture reference requires `bidirectional`, so AC1 fails and downstream contract validation can reject expected usage (packages/shared/src/flex/facets/catalog.ts:731, docs/architecture/flex-agents-server/512-reference-facet-catalog.md:379).
- Gate decision recorded as CONCERNS in docs/qa/gates/11.4-flex-marketing-company-information-facet.yml.
