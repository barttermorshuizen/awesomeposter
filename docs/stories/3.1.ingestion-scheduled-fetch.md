# Story 3.1: Scheduled Source Fetching

## Status
Draft

## Story
**As the** discovery ingestion service,
**I want** to fetch client sources on their configured cadence without overlapping runs,
**so that** normalized items stay fresh and reliable.

## Acceptance Criteria
1. Each source stores a fetch interval (default 60 minutes) and scheduler respects it with no overlapping jobs per source.
2. Concurrent fetches for different sources are allowed but capped to configurable worker pool size.
3. Scheduler records job start/end timestamps and success/failure to telemetry.
4. Failures (network, HTTP status â‰¥400) are logged with reason codes and retried according to backoff policy defined in Story 3.3.

## Tasks / Subtasks
- [ ] Implement scheduler using existing job framework (`packages/agents-server` or `server/jobs`).
- [ ] Persist per-source next-run timestamp and update atomically after each job (AC 1).
- [ ] Add worker pool configuration (env) and guard to prevent overrun (AC 2).
- [ ] Emit telemetry events `ingestion.started` / `ingestion.completed` (AC 3).
- [ ] Document scheduling behavior in runbook (AC 1-4).

## Dev Notes
- Consider using BullMQ or existing queue; coordinate with infra team.
- Ensure scheduler is resilient across restarts (persist state in DB, not memory).

### Testing
- Integration tests mocking HTTP responses to confirm scheduling/backoff.
- Use fake timers to simulate long-running schedules.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-03-29 | 0.1 | Draft for Epic: Ingestion & Normalization. | PM |

## Dev Agent Record
_Not yet worked._
