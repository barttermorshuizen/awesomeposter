# Story 11.1: Marketing Capability Taxonomy & Facet Alignment

## Status
Ready for dev

## Story
**As a** flex orchestration product strategist,  
**I want** a documented marketing-agency capability taxonomy with aligned facet metadata,  
**so that** we can author a consistent six-capability catalog for the flex sandbox before replacing the live registry.

**Dependencies:** None; first story in the marketing capabilities epic.

## References
- `docs/prd/epic-flex-marketing-agency-capabilities.md`
- `docs/architecture/flex-agents-server.md#5-6-agentcapability`
- `docs/architecture/flex-agents-server.md#facet-definition`
- `docs/architecture/flex-agents-server.md#facet-aligned-capabilities`
- `docs/architecture/flex-agents-server.md#developer-sandbox`
- `docs/architecture/flex-agents-server.md#maintenance-checklist`
- `docs/architecture/tech-stack.md#1-core-runtime-components`
- `docs/architecture/coding-standards.md#4-agents-server-standards`
- `docs/architecture/source-tree.md#4-agents-server`

## Acceptance Criteria
1. Produce a marketing-agency capability taxonomy covering exactly six capabilities, each documented with `capabilityId`, summary, version, input traits, and ownership in the architecture spec, following the `AgentCapability` requirements. (`docs/architecture/flex-agents-server.md#5-6-agentcapability`)
2. For every capability in the taxonomy, enumerate the input and output facet arrays, introducing or updating facet definitions with directionality, schema, and semantics as needed so planner and execution layers can resolve them deterministically. (`docs/architecture/flex-agents-server.md#facet-definition`, `docs/architecture/flex-agents-server.md#facet-aligned-capabilities`)
3. Tag the marketing capabilities and associated facets for sandbox discovery (e.g., catalog tags, grouping metadata) and outline how the flex sandbox metadata endpoint will expose the curated set without changing transport contracts, preparing Story 11.2 to rip-and-replace the registry. (`docs/architecture/flex-agents-server.md#developer-sandbox`, `docs/prd/epic-flex-marketing-agency-capabilities.md`)

## Tasks / Subtasks
- [ ] Draft the six marketing capability definitions (IDs, summaries, traits, owners, versions) in a dedicated subsection of the architecture spec for hand-off to implementation. (AC 1) (`docs/architecture/flex-agents-server.md#5-6-agentcapability`)
- [ ] Define facet metadata (name, schema, semantics, directionality, tags) that each capability consumes or produces, ensuring catalog completeness for planner/validator usage. (AC 2) (`docs/architecture/flex-agents-server.md#facet-definition`, `docs/architecture/flex-agents-server.md#facet-aligned-capabilities`)
- [ ] Annotate capability and facet entries with marketing-specific tags or grouping keys that the sandbox metadata API can filter on, and document the exposure plan for Story 11.2. (AC 3) (`docs/architecture/flex-agents-server.md#developer-sandbox`)
- [ ] Summarize open risks or assumptions (e.g., latent sandbox bugs, legacy capability fallback) to feed into Story 11.2 validation scope. (AC 3) (`docs/prd/epic-flex-marketing-agency-capabilities.md`)

## Story Context
- Epic goal is to ship a curated marketing capability set leveraging the existing flex sandbox with no new runtime features. (`docs/prd/epic-flex-marketing-agency-capabilities.md`)
- Flex agents server relies on the shared `AgentCapability` model and facet contracts exported from `@awesomeposter/shared/flex`. (`docs/architecture/flex-agents-server.md#5-6-agentcapability`)
- Sandbox metadata already returns capability snapshots; new marketing entries must conform so downstream consumers remain stable. (`docs/architecture/flex-agents-server.md#developer-sandbox`)

## Dev Notes
- Capabilities must be expressed with full `AgentCapability` payloads (ID, traits, facet contracts, heartbeat metadata) so registry validation and planner scoring remain intact. [Source: architecture/flex-agents-server.md#5-6-agentcapability]
- Facet additions or updates belong in the shared catalog to keep planner, execution, and tests synchronized; maintain directionality and semantics tagging. [Source: architecture/flex-agents-server.md#facet-definition]
- Capability selections depend on facet alignment and scoring; ensure new facets preserve planner derivation guarantees and note any derived-only pairings. [Source: architecture/flex-agents-server.md#facet-aligned-capabilities]
- Marketing sandbox usage should leverage existing feature flags and metadata endpoints without altering transport contracts or authentication flows. [Source: architecture/flex-agents-server.md#developer-sandbox]
- Implementation will occur within the TypeScript workspace (Nitro agents server + shared packages) following existing coding standards (TypeScript, Zod validation, Winston logging). [Source: architecture/tech-stack.md#1-core-runtime-components] [Source: architecture/coding-standards.md#4-agents-server-standards]
- Place shared catalog updates under `packages/shared/src/flex/` and any server-facing documents within `packages/flex-agents-server/src/` per the source tree guide. [Source: architecture/source-tree.md#4-agents-server]

## Project Structure Notes
- Shared capability and facet metadata reside under `packages/shared/src/flex/`; server orchestration or sandbox helpers live under `packages/flex-agents-server/src`. [Source: architecture/source-tree.md#4-agents-server]

## Testing
- Plan to execute the flex catalog validation suites after implementation: `npm run test:unit -- packages/shared/__tests__/flex/facet-contract-compiler.spec.ts packages/flex-agents-server/__tests__/facets/facet-contracts.spec.ts packages/flex-agents-server/__tests__/capability-registry-facets.spec.ts packages/flex-agents-server/__tests__/docs/facet-inventory.spec.ts`. [Source: architecture/flex-agents-server.md#maintenance-checklist]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 0.1 | Initial draft defining marketing capability taxonomy scope and alignment tasks. | Scrum Master |
