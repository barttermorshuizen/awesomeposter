# Story 10.9: Flex Human Social Post Preview & Approval Trigger

## Status
Ready for Review

## Story
**As a** director responsible for final social approvals,  
**I want** the flex human task panel to render a combined social post preview,  
**so that** I can visually assess the composed deliverable.

**Dependencies:** Requires completion of Story 10.3 (flex human task surfaces shell) and Story 10.6 (post visual widget contract) so the task panel already renders facet-driven content. (`docs/stories/10.3.flex-human-task-surfaces.md`, `docs/stories/10.6.flex-human-post-visual-widget.md`)

## Acceptance Criteria
1. When a task node exposes a `post_copy` string and a `post_visual` array of asset URLs (or the consolidated `post`) in the run context, the facet widget registry resolves a `social_post.preview` entry that renders a combined preview inside `FlexTaskPanel.vue`, presenting copy text with visual thumbnails for each URL when one or more images are provided. (`docs/architecture/flex-agents-server.md#154-facet-driven-task-surfaces`, `docs/architecture/flex-agents-server/512-reference-facet-catalog.md#facet-post_copy`, `docs/architecture/flex-agents-server/512-reference-facet-catalog.md#facet-post_visual`, `docs/architecture/flex-agents-server/512-reference-facet-catalog.md#facet-post`)
2. When `post_visual` is empty, the widget renders a text-only preview that still shows `post_copy` with an explicit "No visuals provided" state.
3. Unit tests cover the widget rendering for text-only, single-image, and multi-image scenarios.
6. Architecture documentation for facet-driven task surfaces is updated to describe the new `social_post.preview` registration and the supported `post_visual` variants.

## Tasks / Subtasks
- [x] Register a `social_post.preview` widget in the facet widget registry and ensure the flex task panel resolves it when post copy/visual facets (or `post`) are present. (`src/components/flex-tasks/widgets/registry.ts`, `docs/architecture/flex-agents-server.md#154-facet-driven-task-surfaces`)
- [x] Implement `SocialPostPreview.vue` (or equivalent) to render combined copy and visual thumbnails for single- and multi-image arrays, reusing existing post visual gallery utilities where possible, and provide a text-only fallback when no visuals are supplied. (`src/components/flex-tasks/widgets/`, `docs/architecture/source-tree.md#2-spa`)
- [x] Add Vitest coverage for the widget
- [x] Document the new widget mapping in the architecture docs under task surfaces, including handled `post_visual` types (image arrays, empty arrays). (`docs/architecture/flex-agents-server.md#154-facet-driven-task-surfaces`)

## Story Context
- Director review already consumes `post_copy`, `post_visual`, and emits the combined `post` facet; current UI shows these as separate raw facets. (`docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#current-inventory`, `docs/architecture/flex-agents-server/512-reference-facet-catalog.md#facet-post`)
- The run context supplies a single `post_copy` string and a `post_visual` array of asset URLs. For this story, support empty arrays (text-only) and image arrays (single image or multi-image carousels). Ignore PDF or video entries by treating them as missing visuals.
-
## Dev Notes
- Keep the preview layout intentionally simple (single-column copy plus image stack) to stay within scope; future stories can add channel-specific frames. (`docs/stories/10.3.flex-human-task-surfaces.md`)
- Reuse existing thumbnail helpers from `post_visual` widgets to avoid duplicating asset fetch logic. (`docs/stories/10.6.flex-human-post-visual-widget.md`)
- Only image URLs need to be rendered for this story. Arrays that contain PDF or video URLs can defer to future enhancements but should not break the previewâ€”treat them as missing visuals for now.

## Testing
- `npm run test:unit`
- Cover widget behavior for: text-only (empty `post_visual` array), single-image array, and multi-image arrays.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-04-14 | 0.1 | Initial draft defining social post preview widget and HITL approval bridge. | Product Owner |
| 2025-04-14 | 0.2 | Removed hitl - not in this story. | Product Owner |

## Dev Agent Record

### Agent Model Used
- GPT-5 (Codex)

### Debug Log References
- `npm run test:unit -- SocialPostPreview`

### Completion Notes List
- `SocialPostPreview` derives copy + image thumbnails from facet context, now registered as the `post` output widget (with optional `social_post.preview` support) and documented in task surface mappings.

### File List
- `packages/shared/src/flex/facets/catalog.ts`
- `src/components/flex-tasks/FlexTaskPanel.vue`
- `src/components/flex-tasks/widgets/registry.ts`
- `src/components/flex-tasks/widgets/SocialPostPreview.vue`
- `src/components/flex-tasks/widgets/__tests__/SocialPostPreview.spec.ts`
- `docs/architecture/flex-agents-server.md`

## QA Results

_Not yet reviewed. QA to update this section only._
