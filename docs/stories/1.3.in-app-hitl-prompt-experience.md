# Story 1.3: In-App HITL Prompt Experience

## Status
Approved

## Story
**As an** internal operator,
**I want** to review and answer HITL prompts within the create-post popup,
**so that** I can guide the orchestration without leaving my current workflow while the orchestrator pauses awaiting a single HITL response.

## Acceptance Criteria
1. Create-post popup surfaces a HITL panel showing the single active HITL question with metadata (origin agent, timestamp, type).
2. Operators can approve/reject, select from provided options, or submit free-form answers; validation enforces required fields per request type.
3. UI updates in near real time when the active HITL prompt arrives, resolves, or clears without needing a full page refresh.
4. Responses are submitted to the server and success/failure states are communicated to the operator.

## Tasks / Subtasks
- [ ] Design Vuetify-based HITL panel component(s) within the create-post popup, showing the currently active prompt with metadata and status chips (AC 1).
  - [ ] Integrate panel with Pinia store/composable that fetches the active HITL task and captures operator responses, enforcing single-task invariant (AC 1, AC 3).
- [ ] Implement form flows for approve/reject, option selection, and free-form answer types with validation feedback (AC 2).
  - [ ] Provide inline error states and disable submission until requirements satisfied (AC 2).
- [ ] Wire response submission to Nitro HITL endpoints (Story 1.2) with optimistic updates and rollback on failure (AC 4).
  - [ ] Surface toasts or inline banners confirming success/failure outcomes to the operator (AC 4).
- [ ] Add polling or SSE subscription to refresh the HITL panel when the single active prompt arrives/resolves without full popup reload (AC 3).
  - [ ] Ensure state reconciliation handles denial reasons (e.g., "Too many HITL requests") and resets to idle when no active HITL is present (AC 3).

## Dev Notes
- UI code lives in `src/components` / `src/views`; follow existing create-post popup patterns (check `src/views` and Vuetify layout conventions).
- Reuse existing Pinia stores or define a scoped store in `src/stores/hitl.ts`; ensure state resets when popup closes.
- Coordinate with Story 1.2 API contracts; responses should call `POST /api/hitl/resume` and include request ID + payload aligned with the runbook. Ensure orchestrator pause/resume semantics are respected (run stays paused until the single active response posts) and surface backend status codes/messages consistently (Must-fix dependency).
- For real-time updates, evaluate existing SSE client utilities; if absent, fall back to short polling (configurable interval) respecting performance constraints. Maintain invariant of one active HITL task shown at any moment.

### Testing
- Component/unit tests in `src/__tests__` verifying validation, optimistic updates, single-active-task rendering, and idle reset (Vitest + Vue Test Utils).
- Integration test through mocked API adapter ensuring responses propagate to orchestrator, trigger resume, and state clears appropriately, including UI messaging derived from backend status codes.
- Exercise the real-time update path (SSE subscription or polling fallback) in test harness to confirm the panel refreshes when prompts arrive/resolve without a dialog reload. Introduce a lightweight SSE client mock (e.g., wrapping `postEventStream`) to simulate streaming frames in component tests since none exists today.
- Manual UX pass to verify keyboard navigation, screen reader labels, and alignment with existing Vuetify theming.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-24 | 0.1 | Initial draft of Story 1.3 from Epic HITL-1. | PO |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
