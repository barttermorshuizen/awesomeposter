# Story 12.3: Social Strategist Asset Inventory Alignment

## Status
Ready for Dev

## Story
**As a** flex marketing orchestration lead,  
**I want** the social strategist agent to enumerate available creative assets and weave feasible format guidance into its briefs,  
**so that** recommendations stay grounded in what our teams can actually deploy while preserving existing planner and execution contracts.

**Dependencies:** Requires completion of Story 12.2 to ensure analytics telemetry and fallbacks are already integrated ahead of asset-aware guidance. (`docs/stories/12.2.flex-social-strategist-analytics-integration.md`)

## References
- `docs/prd/epic-flex-social-strategist-enhancement.md`
- `docs/architecture/flex-agents-server/5-core-concepts.md#55-contextbundle`
- `docs/architecture/flex-agents-server/6-component-responsibilities.md#6-component-responsibilities`
- `docs/architecture/flex-agents-server/6-component-responsibilities.md#telemetry-metrics-parity`
- `docs/architecture/flex-agents-server/7-execution-flow.md#7-execution-flow`
- `docs/architecture/flex-agents-server/10-api-surface-initial.md#1001-flex-run-streaming-contract`
- `docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#current-inventory`
- `docs/architecture/flex-agents-server/512-reference-facet-catalog.md`
- `docs/architecture/flex-agents-server/1511-post-visual-r2-endpoint-patterns.md`
- `docs/architecture/flex-agents-server/index.md`
- `docs/architecture/tech-stack.md#1-core-runtime-components`
- `docs/architecture/coding-standards.md#4-agents-server-standards`
- `docs/architecture/source-tree.md#4-agents-server`

## Acceptance Criteria
1. Introduce an asset inventory helper that enumerates strategist-accessible creatives from existing R2-backed manifests and storage descriptors, merging its payload into the strategist `ContextBundle` alongside retrieval and analytics context while preserving planner/execution contracts and graceful degradation when tooling is disabled. (`docs/prd/epic-flex-social-strategist-enhancement.md`, `docs/architecture/flex-agents-server/5-core-concepts.md#55-contextbundle`, `docs/architecture/flex-agents-server/1511-post-visual-r2-endpoint-patterns.md`)
2. Update the `strategist.SocialPosting` capability registration to advertise asset readiness (configuration knobs, health signals, catalog metadata) without breaching compatibility requirements or altering external API contracts, ensuring registry snapshots and SSE emissions surface asset state. (`docs/prd/epic-flex-social-strategist-enhancement.md#compatibility-requirements`, `docs/architecture/flex-agents-server/6-component-responsibilities.md#telemetry-metrics-parity`, `docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#current-inventory`)
3. Guarantee resilient fallbacks when no assets are available by returning a deterministic “no assets available” payload, emitting telemetry that mirrors other strategist fallbacks, and keeping planner/execution behaviour stable. (`docs/prd/epic-flex-social-strategist-enhancement.md#risk-mitigation`, `docs/architecture/flex-agents-server/6-component-responsibilities.md#6-component-responsibilities`, `docs/architecture/flex-agents-server/7-execution-flow.md#7-execution-flow`)
4. Extend Vitest coverage to assert asset-enriched strategist runs (available assets and fallback) update telemetry frames and context payloads as expected, aligning with existing verification suites. (`docs/prd/epic-flex-social-strategist-enhancement.md#success-criteria`, `docs/architecture/flex-agents-server/13-verification.md`)
5. Document asset inventory integration patterns in the flex agents architecture specification, including tool contracts, configuration hooks, telemetry expectations, and maintenance guidance for future agents. (`docs/prd/epic-flex-social-strategist-enhancement.md`, `docs/architecture/flex-agents-server/index.md`)

## Tasks / Subtasks
- [ ] Define the asset inventory scope (supported formats, freshness expectations, fallback messaging) and map required storage descriptors leveraging existing flex asset patterns. (AC 1, AC 3) (`docs/prd/epic-flex-social-strategist-enhancement.md`, `docs/architecture/flex-agents-server/1511-post-visual-r2-endpoint-patterns.md`)
- [ ] Implement an asset inventory helper within the agents server workspace that consumes R2 manifests or catalog data, exposes typed results for the strategist context builder, and respects configuration toggles. (AC 1) (`docs/architecture/flex-agents-server/5-core-concepts.md#55-contextbundle`, `docs/architecture/source-tree.md#4-agents-server`)
- [ ] Integrate asset data into strategist context assembly and capability registration, ensuring metadata, health signals, and configuration options surface consistently with existing retrieval and analytics wiring. (AC 1, AC 2, AC 3) (`docs/architecture/flex-agents-server/6-component-responsibilities.md#6-component-responsibilities`, `docs/architecture/flex-agents-server/11-capability-registry-agent-contracts.md#current-inventory`)
- [ ] Emit deterministic fallback payloads and telemetry when assets are unavailable, reusing strategist resilience patterns and SSE event naming. (AC 3) (`docs/architecture/flex-agents-server/6-component-responsibilities.md#telemetry-metrics-parity`, `docs/architecture/flex-agents-server/10-api-surface-initial.md#1001-flex-run-streaming-contract`)
- [ ] Expand Vitest suites to cover asset-available and asset-fallback runs, asserting context payload composition, telemetry frames, and registry metadata. (AC 4) (`docs/architecture/flex-agents-server/13-verification.md`)
- [ ] Update flex agents architecture documentation with an asset inventory section covering tool contracts, configuration, telemetry, and maintenance workflows. (AC 5) (`docs/architecture/flex-agents-server/index.md`)

## Story Context
- Epic objective is to combine retrieval knowledge, analytics insights, and asset awareness without changing existing planner/orchestrator contracts. (`docs/prd/epic-flex-social-strategist-enhancement.md`)
- Asset catalog tooling must rely on current storage descriptors (Cloudflare R2-backed manifests or metadata services) without upstream pipeline changes. (`docs/prd/epic-flex-social-strategist-enhancement.md`)
- Strategist enhancements should remain confined to the agents server workspace to honour compatibility requirements. (`docs/prd/epic-flex-social-strategist-enhancement.md#compatibility-requirements`)

## Dev Notes
- **Previous Story Insights:** Analytics integration (Story 12.2) already emits telemetry and fallback payloads; asset tooling should reuse the same resilience pattern to avoid divergent strategist behaviour. [Source: docs/stories/12.2.flex-social-strategist-analytics-integration.md]
- **Data Models:** Flex run persistence captures context bundles for audit; asset hints should remain transient context data unless persistence requirements emerge. [Source: docs/architecture/flex-agents-server/9-data-model-persistence.md]
- **API Specifications:** Strategist runs continue to stream via `/api/v1/flex/run.stream`, so asset telemetry must align with existing SSE contracts. [Source: docs/architecture/flex-agents-server/10-api-surface-initial.md#1001-flex-run-streaming-contract]
- **Component Specifications:** `ContextBuilder`, `ExecutionEngine`, and `TelemetryService` coordinate strategist invocations; integrate asset helpers without altering control flow or contract enforcement. [Source: docs/architecture/flex-agents-server/6-component-responsibilities.md#6-component-responsibilities] [Source: docs/architecture/flex-agents-server/6-component-responsibilities.md#telemetry-metrics-parity] [Source: docs/architecture/flex-agents-server/7-execution-flow.md#7-execution-flow]
- **File Locations:** Strategist agents and supporting helpers live under `packages/flex-agents-server/src/agents/marketing/` and shared utilities under `packages/flex-agents-server/src/utils/`; place new asset inventory modules alongside these paths. [Source: docs/architecture/source-tree.md#4-agents-server]
- **Testing Requirements:** Extend Vitest suites in `packages/flex-agents-server/__tests__/` to validate asset integration scenarios in line with verification standards. [Source: docs/architecture/flex-agents-server/13-verification.md]
- **Technical Constraints:** Implement changes in TypeScript, honour strict typing, and follow agents-server coding conventions while keeping enhancements self-contained. [Source: docs/architecture/tech-stack.md#1-core-runtime-components] [Source: docs/architecture/coding-standards.md#4-agents-server-standards] [Source: docs/prd/epic-flex-social-strategist-enhancement.md#compatibility-requirements]
- **Documentation Requirements:** Update the flex agents architecture specification to detail asset inventory tooling and maintenance patterns. [Source: docs/architecture/flex-agents-server/index.md]
- **Runtime Practices:** Mirror strategist retrieval/analytics fallbacks by emitting deterministic “no assets available” context markers and warnings so operators can diagnose catalogue gaps quickly. [Source: docs/prd/epic-flex-social-strategist-enhancement.md#risk-mitigation]

## Project Structure Notes
- Keep asset helpers, strategist updates, and related tests within the agents server workspace, introducing shared types only when other capabilities need them. [Source: docs/architecture/source-tree.md#4-agents-server]

## Testing
- `npm run test:unit -- packages/flex-agents-server/__tests__/marketing-strategist-retrieval.spec.ts packages/flex-agents-server/__tests__/marketing-flex-run.integration.spec.ts packages/flex-agents-server/__tests__/marketing-strategist-assets.spec.ts` (extend or add suites covering asset inventory integration and fallbacks). [Source: docs/architecture/flex-agents-server/13-verification.md]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-30 | 0.1 | Draft story describing strategist asset inventory integration, fallbacks, telemetry, and documentation updates. | Scrum Master |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
