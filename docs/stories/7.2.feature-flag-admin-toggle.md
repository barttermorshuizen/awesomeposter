# Story 7.2: Admin Flag Toggle Workflow

## Status
Draft

## Story
**As an** internal admin,
**I want** to enable or disable the discovery agent per client via a controlled workflow,
**so that** pilots can be started or stopped with auditability.

## Acceptance Criteria
1. Admin UI or CLI lists clients with current discovery flag state and allows toggling with confirmation.
2. Each toggle logs actor, timestamp, client, previous state, new state.
3. Toggle propagates to all services within 5 minutes; progress visible in log or UI.
4. Failed toggle operations surface actionable error messages and leave system in previous state.

## Tasks / Subtasks
- [ ] Build admin page or CLI command `discovery:toggle --client <id> --enable/--disable` (AC 1).
- [ ] Write audit logging integration storing change history (AC 2).
- [ ] Emit notification/telemetry `discovery.flagChanged` for monitoring (AC 3).
- [ ] Implement rollback mechanism on failure (AC 4).
- [ ] Add integration tests verifying propagation and error handling (AC 3, AC 4).

## Dev Notes
- If using CLI, ensure it authenticates and respects least privilege.
- Provide instructions in runbook referencing toggle workflow.

### Testing
- Automated tests toggling flag and confirming ingestion respects update.
- Manual QA with pilot sandbox client.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-03-29 | 0.1 | Draft for Epic: Feature Flag & Pilot Enablement. | PM |

## Dev Agent Record
_Not yet worked._
