# Story 6.1: SSE Event Stream

## Status
Draft

## Story
**As** the front-end application,
**I want** a reliable SSE endpoint for discovery events,
**so that** users see pipeline activity in near real time.

## Acceptance Criteria
1. Authenticated clients can subscribe to `/api/events/discovery` and receive only their client-specific events.
2. SSE payload includes fields: `schemaVersion`, `eventType`, `clientId`, `entityId`, `timestamp`, `payload`.
3. Server automatically heartbeats every 30 seconds to keep connection alive; clients auto-reconnect within 5 seconds after drop.
4. Endpoint enforces rate limits (max 5 concurrent connections per user) and logs connections/disconnections for monitoring.

## Tasks / Subtasks
- [ ] Implement SSE controller in Nitro API with client scoping and auth checks (AC 1).
- [ ] Define payload schema and version constant shared with frontend (AC 2).
- [ ] Add heartbeat timer and reconnect guidelines (AC 3).
- [ ] Integrate rate limiting and connection logging (AC 4).
- [ ] Write integration tests simulating multiple clients and reconnection scenarios (AC 1-4).

## Dev Notes
- Reuse existing SSE infrastructure (check `src/lib/agent-sse.ts`).
- Ensure payload respects ASCII requirement where possible.

### Testing
- Unit/integration: `pnpm test --filter discovery-sse`.
- Manual verification via curl/EventSource.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-03-29 | 0.1 | Draft for Epic: Telemetry & Reporting. | PM |

## Dev Agent Record
_Not yet worked._
