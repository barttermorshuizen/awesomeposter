# Story 5.1: Discovery Item Listing & Filtering

## Status
Draft

## Executive Summary
- Frontend foundation (routing, Pinia store shell, virtualization dependency) now tracked in Story 5.0.
- Backend `/api/discovery/search` contract, indexing, and load tests live in Story 5.5.
- This slice focuses on wiring the UI to those dependencies: filters, keyword search, pagination thresholds, and resilient empty/error/SSE states.
- Telemetry dashboards, rollback runbooks, and analytics instrumentation defer to Epic 6/7 follow-ups once the UI behavior is stable.

## Story
**As a** reviewer,
**I want** to browse `Spotted` discovery items (nuggets) with rich filtering and search,
**so that** I can quickly find nuggets relevant to my campaign.

## Dependencies
- Story 5.0 (Discovery Dashboard Foundation) provides the view shell, store scaffolding, virtualization dependency, and feature flag guard.
- Story 5.5 (Discovery Search API & Highlighting) delivers `/api/discovery/search`, pagination contracts, highlight metadata, and telemetry hooks.

## Acceptance Criteria
1. Filters for source, topic keyword, status, and date range render inside `DiscoveryDashboardView`, stay in sync with router query params, and persist through `useDiscoveryListStore`; toggling filters triggers list reload using the new API.
2. Keyword search calls `/api/discovery/search` with `searchTerm`, renders returned highlight snippets without XSS risk, and shows search term echo with result count.
3. Pagination supports page sizes 25/50/100 and activates virtualization when total items exceed configured threshold (default 250); fallback to standard paginated table is documented when virtualization fails.
4. Default view applies the last 48-hour preset for `status=spotted` sorted by score, respecting feature-flag defaults; users can clear/reset filters via a single control.
5. Empty results, backend errors, and SSE disconnects display dedicated UI states with retry guidance; SSE reconnect attempts align with store controls and fall back to scheduled polling when triggered by Story 5.5 telemetry flags.
6. UI meets accessibility (keyboard navigation, ARIA labels) and responsive breakpoints (desktop ≥1280px, tablet 768–1279px, mobile ≤767px) for filters and list layouts.

## Tasks / Subtasks
- [ ] Implement filter components (source/topic/status/date) bound to Pinia store and router queries, ensuring debounced API requests (AC 1).
- [ ] Connect keyword search input to `/api/discovery/search` via service module, render highlight chips/snippets safely, and show matched term summary (AC 2).
- [ ] Configure pagination + virtualization thresholds and document fallback behavior inside the component/story notes (AC 3).
- [ ] Apply default filter preset on initial load with reset/clear affordances and feature-flag awareness (AC 4).
- [ ] Build empty/error/loading/SSE degrade UI states with retry + polling fallback toggles (AC 5).
- [ ] Add accessibility + responsive adjustments, including keyboard traversal of filter chips, form labels, and mobile layout tweaks (AC 6).
- [ ] Update component/unit tests plus Playwright smoke to cover filter-sync, pagination, and SSE degrade scenarios (AC 1-6).

## Risk Assessment
- API latency higher than expected could make virtualization thresholds ineffective; coordinate with backend Story 5.5 benchmarks.
- SSE fallback path depends on telemetry flags; ensure mocks simulate degraded mode during testing.
- Debounce window tuning may affect real-time filter responsiveness; gather UX feedback post-implementation.

## Implementation Notes
- Use service layer from Story 5.0 scaffolding (`src/services/discovery/briefs.ts` or renamed `search.ts`) to centralize API interactions.
- Maintain optimistic UI state during filter changes; show skeleton loaders to preserve perceived performance.
- Highlight rendering should reuse shared utility (`highlightSnippets`) supplied by Story 5.5 to avoid duplicating escape logic.

## Testing
- Frontend unit/integration tests for filter sync, pagination thresholds, highlight rendering, and accessibility helpers.
- Playwright smoke scenario: flag enabled → default filter load; adjust filters, keyword search, virtualized list scroll, SSE disconnect simulation.
- Contract tests stub `/api/discovery/search` to validate query param construction and error handling.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-03-29 | 0.1 | Initial draft (pre-split scope). | PM |
| 2025-03-31 | 0.2 | Revised after Sprint Change Proposal; narrowed scope and added dependencies on Stories 5.0 and 5.5. | SM |

## Dev Agent Record
_Not yet worked._
